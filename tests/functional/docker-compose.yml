version: '3.8'

services:

  fastapi:
    build: ../../src
    image: fastapi-image
    env_file:
      - ../../.env

  tests:
    image: fastapi-image
    entrypoint: >
      sh -c "pip install -r requirements.txt
      && python3 ../utils/wait_for_es.py
      && python3 ../utils/wait_for_redis.py
      && pytest"